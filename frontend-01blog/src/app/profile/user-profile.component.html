<div class="main-content">

  @if (isLoading()) {
  <div class="loading-message">Loading profile...</div>
  } @else if (profile()) {

  <div class="profile-layout">

    <!-- PROFILE CARD -->
    <div class="profile-card">
      <div class="cover-photo"></div>

      <div class="profile-content">
        <div class="profile-top">
          <div class="avatar-lg">
            @if (profile()?.avatarUrl) {
            <img [src]="profile()?.avatarUrl" style="width:100%; height:100%; object-fit:cover; border-radius:50%;">
            } @else {
            {{ profile()?.username?.charAt(0)?.toUpperCase() }}
            }
          </div>

          <div class="action-area">
            @if (currentUser() && currentUser() !== profile()?.username) {
            <button (click)="toggleFollow()" class="follow-btn" [class.unfollow]="isFollowing()">
              {{ isFollowing() ? 'Unfollow' : 'Follow' }}
            </button>
            }
          </div>
        </div>

        <h1 class="username-title">
          {{ profile()?.username }}
          @if (profile()?.role === 'ADMIN') { <span class="admin-tag"
            style="font-size: 0.5em; background: #f59e0b; color: white; padding: 2px 6px; border-radius: 4px; vertical-align: middle;">Admin</span>
          }
        </h1>

        <div class="stats-bar">
          <div class="stat-item">
            <span class="stat-val">{{ posts().length }}</span>
            <span class="stat-label">Thoughts</span>
          </div>
          <div class="stat-item">
            <span class="stat-val">{{ profile()?.followersCount || 0 }}</span>
            <span class="stat-label">Followers</span>
          </div>
          <div class="stat-item">
            <span class="stat-val">{{ profile()?.followingCount || 0 }}</span>
            <span class="stat-label">Following</span>
          </div>
        </div>
      </div>
    </div>

    <!-- POSTS -->
    <h2 class="section-title">Latest Thoughts</h2>

    <div class="users-posts">
      @for (post of posts(); track post.id) {
      <div class="post-card">
        <span class="post-date">{{ post.createdAt | date:'mediumDate' }}</span>
        <h3>{{ post.title }}</h3>
        <p>{{ post.content }}</p>
        @if (post.mediaUrl) {
        <div class="media-container">
          <img [src]="post.mediaUrl" style="max-width: 100%; border-radius: 8px;">
        </div>
        }
      </div>
      }
    </div>

  </div>

  } @else {
  <div class="not-found-message">User not found.</div>
  }
</div>